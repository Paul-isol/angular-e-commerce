<div class="container mx-auto p-4 max-w-6xl">
  @if(loading()){
  <div class="container mx-auto p-4 max-w-6xl">
    <div class="flex justify-between items-center mb-6">
      <div class="skeleton h-8 w-48"></div>
      <div class="skeleton h-8 w-24 rounded-lg"></div>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
      <div class="flex-1 w-full flex flex-col gap-4">
        <div class="card card-side bg-base-100 shadow-sm border border-base-200">
          <div class="skeleton w-32 h-32 md:w-48 md:h-48 shrink-0 rounded-none rounded-l-2xl"></div>

          <div class="card-body p-4 sm:p-6 w-full">
            <div class="flex justify-between items-start">
              <div class="space-y-2 w-full">
                <div class="skeleton h-5 w-3/4 max-w-[200px]"></div>
                <div class="skeleton h-4 w-1/2"></div>
                <div class="skeleton h-5 w-16 mt-2 rounded-full"></div>
              </div>
              <div class="skeleton h-8 w-8 rounded-lg"></div>
            </div>

            <div class="flex justify-between items-end mt-auto pt-4">
              <div class="skeleton h-8 w-24 rounded-lg"></div>
              <div class="skeleton h-7 w-20"></div>
            </div>
          </div>
        </div>

        <div class="card card-side bg-base-100 shadow-sm border border-base-200">
          <div class="skeleton w-32 h-32 md:w-48 md:h-48 shrink-0 rounded-none rounded-l-2xl"></div>
          <div class="card-body p-4 sm:p-6 w-full">
            <div class="flex justify-between items-start">
              <div class="space-y-2 w-full">
                <div class="skeleton h-5 w-2/3 max-w-[180px]"></div>
                <div class="skeleton h-4 w-1/3"></div>
              </div>
              <div class="skeleton h-8 w-8 rounded-lg"></div>
            </div>
            <div class="flex justify-between items-end mt-auto pt-4">
              <div class="skeleton h-8 w-24 rounded-lg"></div>
              <div class="skeleton h-7 w-20"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:w-96 w-full lg:sticky lg:top-4 h-fit">
        <div class="card bg-base-100 shadow-xl border border-base-200">
          <div class="card-body">
            <div class="flex justify-between mb-4">
              <div class="skeleton h-6 w-32"></div>
              <div class="skeleton h-4 w-12"></div>
            </div>

            <div class="space-y-4 mt-4">
              <div class="flex justify-between">
                <div class="skeleton h-4 w-16"></div>
                <div class="skeleton h-4 w-12"></div>
              </div>
              <div class="flex justify-between">
                <div class="skeleton h-4 w-24"></div>
                <div class="skeleton h-4 w-12"></div>
              </div>
              <div class="flex justify-between">
                <div class="skeleton h-4 w-10"></div>
                <div class="skeleton h-4 w-12"></div>
              </div>
            </div>

            <div class="divider my-2"></div>

            <div class="flex justify-between items-center mb-6">
              <div class="skeleton h-6 w-24"></div>
              <div class="skeleton h-8 w-20"></div>
            </div>

            <div class="skeleton h-12 w-full rounded-lg"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  } @else if (items()?.length) {
  <div class="container mx-auto p-4 max-w-6xl">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">Shopping Cart (2 items)</h1>
      <button (click)="onClearCart()" class="btn btn-ghost text-error btn-sm hover:bg-error/10">
        <lucide-icon
          [img]="icons.Trash2"
          class="h-3 w-3 mr-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        />
        Clear All
      </button>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
      <div class="flex-1 w-full flex flex-col gap-4">
        @for(item of items(); track item.product.id){
        <div class="card card-side bg-base-100 shadow-sm border border-base-200">
          <figure class="w-32 h-32 md:w-48 md:h-48 bg-white p-2 shrink-0">
            <img
              [src]="item.product.image"
              [alt]="item.product.title"
              class="w-full h-full object-contain"
            />
          </figure>
          <div class="card-body p-4 sm:p-6 w-full">
            <div class="flex justify-between items-start">
              <div>
                <h2 class="card-title text-lg">{{ item.product.title }}</h2>
                <p class="text-sm text-base-content/60">{{ item.product.category }}</p>
                <div class="badge badge-success badge-sm badge-outline mt-2">In Stock</div>
              </div>
              <button (click)="onRemove(item.product.id)" class="btn btn-square btn-ghost btn-sm text-base-content/40 hover:text-error">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <div class="flex justify-between items-end mt-auto pt-4">
              <div class="join border border-base-300">
                <button
                  (click)="onUpdateQuantity(item.product.id, item.quantity - 1)"
                  class="btn btn-sm btn-ghost join-item px-2"
                >
                  -
                </button>
                <button
                  class="btn btn-sm btn-ghost join-item no-animation cursor-default w-10 bg-base-100"
                >
                  {{item.quantity}}
                </button>
                <button
                  (click)="onUpdateQuantity(item.product.id, item.quantity + 1)"
                  class="btn btn-sm btn-ghost join-item px-2"
                >
                  +
                </button>
              </div>
              <div class="text-right">
                <p class="text-xl font-bold">${{ item.product.price }}</p>
              </div>
            </div>
          </div>
        </div>
        }
      </div>

      <div class="lg:w-96 w-full lg:sticky lg:top-4 h-fit">
        <div class="card bg-base-100 shadow-xl border border-base-200">
          <div class="card-body">
            <h2 class="card-title justify-between">
              Order Summary
              <span class="text-xs font-normal text-base-content/60">{{cartCount()}} items</span>
            </h2>

            <div class="space-y-3 mt-4">
              <div class="flex justify-between text-sm">
                <span class="text-base-content/70">Subtotal</span>
                <span class="font-medium">$310.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-base-content/70">Shipping estimate</span>
                <span class="font-medium">$15.00</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-base-content/70">Tax estimate</span>
                <span class="font-medium">$24.80</span>
              </div>
            </div>

            <div class="divider my-2"></div>

            <div class="flex justify-between items-center">
              <span class="text-lg font-bold">Order Total</span>
              <span class="text-2xl font-bold text-primary">${{cartTotal()|number: '1.0-3'}}</span>
            </div>

            <div class="card-actions flex-col mt-6 gap-3">
              <button class="btn btn-primary btn-block text-lg shadow-lg shadow-primary/30">
                Checkout
              </button>
              <div class="text-center text-xs text-base-content/60">
                <span class="flex items-center justify-center gap-1">
                  <lucide-icon
                    [img]="icons.Lock"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-4"
                  />

                  Secure Checkout
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="collapse collapse-arrow bg-base-100 border border-base-200 mt-4">
          <input type="checkbox" />
          <div class="collapse-title text-sm font-medium">Have a promo code?</div>
          <div class="collapse-content">
            <div class="join w-full">
              <input
                type="text"
                placeholder="Enter code"
                class="input input-bordered input-sm w-full join-item"
              />
              <button class="btn btn-sm btn-neutral join-item">Apply</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  }@else {
  <div class="min-h-[60vh] flex flex-col items-center justify-center gap-6 p-4">
    <div class="bg-base-200 p-8 rounded-full animate-pulse">
      <lucide-icon
        [img]="icons.ShoppingBag"
        class="h-24 w-24 text-base-content/30"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      />
    </div>

    <div class="text-center space-y-2">
      <h2 class="text-3xl font-bold">Your cart is empty</h2>
      <p class="text-base-content/60 max-w-xs mx-auto">
        Looks like you haven't added anything to your cart yet.
      </p>
    </div>

    <button routerLink="/products" class="btn btn-primary btn-wide mt-4">Start Shopping</button>
  </div>
  }
</div>
